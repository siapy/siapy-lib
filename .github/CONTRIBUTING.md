# Guidelines for contributing

## Table of Contents <!-- omit in toc -->

- [Guidelines for contributing](#guidelines-for-contributing)
  - [Summary](#summary)
  - [Git](#git)
  - [Python](#python)
    - [Pdm](#pdm)
      - [Highlights](#highlights)
      - [Key commands](#key-commands)
    - [Testing with pytest](#testing-with-pytest)
  - [GitHub Actions workflows](#github-actions-workflows)
  - [Maintainers](#maintainers)

## Summary

**PRs welcome!**

- **Consider starting a discussion to see if there's interest in what you want to do.**
- **Submit PRs from feature branches on forks to the `develop` branch.**
- **Ensure PRs pass all CI checks.**
- **Maintain test coverage at 100%.**

## Git

- _[Why use Git?](https://www.git-scm.com/about)_ Git enables creation of multiple versions of a code repository called branches, with the ability to track and undo changes in detail.
- Install Git by [downloading](https://www.git-scm.com/downloads) from the website, or with a package manager like [Homebrew](https://brew.sh/).
- [Configure Git to connect to GitHub with SSH](https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh).
- [Fork](https://docs.github.com/en/get-started/quickstart/fork-a-repo) this repo.
- Create a [branch](https://www.git-scm.com/book/en/v2/Git-Branching-Branches-in-a-Nutshell) in your fork.
- Commit your changes with a [properly-formatted Git commit message](https://chris.beams.io/posts/git-commit/).
- Create a [pull request (PR)](https://docs.github.com/en/github/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-pull-requests) to incorporate your changes into the upstream project you forked.

## Python

### Pdm

This project uses [PDM](https://github.com/pdm-project/pdm) for dependency management and packaging.

#### Highlights

- **Automatic virtual environment management**: Automatically manages the application environment.
- **Dependency resolution**: Automatically resolve any dependency version conflicts using the `pip` dependency resolver.
- **Dependency separation**: Supports separate lists of optional dependencies in the _pyproject.toml_. Production installs can skip optional dependencies for speed.
- **Builds**: Features for easily building the project into a Python package and publishing the package to PyPI.

#### Key commands

```sh
pdm init  # Initialize a new project
pdm add PACKAGE_NAME  # Add a package to the project dependencies
pdm install  # Install dependencies from pyproject.toml
pdm list  # Show a list of installed packages
pdm run COMMAND  # Run a command within the PDM environment
pdm shell  # Activate the PDM environment, similar to activating a virtualenv
pdm sync  # Synchronize the project's dependencies
```

### Testing with pytest

- Tests are in the _tests/_ directory.
- [pytest](https://docs.pytest.org/en/latest/) features used include:
  - [capturing `stdout` with `capfd`](https://docs.pytest.org/en/latest/how-to/capture-stdout-stderr.html)
  - [fixtures](https://docs.pytest.org/en/latest/how-to/fixtures.html)
  - [monkeypatch](https://docs.pytest.org/en/latest/how-to/monkeypatch.html)
  - [parametrize](https://docs.pytest.org/en/latest/how-to/parametrize.html)
  - [temporary directories and files (`tmp_path` and `tmp_dir`)](https://docs.pytest.org/en/latest/how-to/tmpdir.html)
- [pytest plugins](https://docs.pytest.org/en/latest/how-to/plugins.html) include:
  - [pytest-mock](https://github.com/pytest-dev/pytest-mock)
- [pytest configuration](https://docs.pytest.org/en/latest/reference/customize.html) is in _pyproject.toml_.
- Run tests with pytest
- Test coverage reports are generated by pytest-cov

<!-- ## Code quality

### Running code quality checks

Code quality checks can be run using the Hatch scripts in _pyproject.toml_.

- Check: `hatch run check`
- Format: `hatch run format`

### Code style

- Python code is formatted with [Ruff](https://docs.astral.sh/ruff/). Ruff configuration is stored in _pyproject.toml_.
- Other web code (JSON, Markdown, YAML) is formatted with [Prettier](https://prettier.io/).

### Static type checking

- To learn type annotation basics, see the [Python typing module docs](https://docs.python.org/3/library/typing.html), [Python type annotations how-to](https://docs.python.org/3/howto/annotations.html), the [Real Python type checking tutorial](https://realpython.com/python-type-checking/), and [this gist](https://gist.github.com/987bdc6263217895d4bf03d0a5ff114c).
- Type annotations are not used at runtime. The standard library `typing` module includes a `TYPE_CHECKING` constant that is `False` at runtime, but `True` when conducting static type checking prior to runtime. Type imports are included under `if TYPE_CHECKING:` conditions so that they are not imported at runtime. These conditions are ignored when calculating test coverage.
- Type annotations can be provided inline or in separate stub files. Much of the Python standard library is annotated with stubs. For example, the Python standard library [`logging.config` module uses type stubs](https://github.com/python/typeshed/blob/main/stdlib/logging/config.pyi). The typeshed types for the `logging.config` module are used solely for type-checking usage of the `logging.config` module itself. They cannot be imported and used to type annotate other modules.
- The standard library `typing` module includes a `NoReturn` type. This would seem useful for [unreachable code](https://typing.readthedocs.io/en/stable/source/unreachable.html), including functions that do not return a value, such as test functions. Unfortunately mypy reports an error when using `NoReturn`, "Implicit return in function which does not return (misc)." To avoid headaches from the opaque "misc" category of [mypy errors](https://mypy.readthedocs.io/en/stable/error_code_list.html), these functions are annotated as returning `None`.
- [Mypy](https://mypy.readthedocs.io/en/stable/) is used for type-checking. [Mypy configuration](https://mypy.readthedocs.io/en/stable/config_file.html) is included in _pyproject.toml_.
- Mypy strict mode is enabled. Strict includes `--no-explicit-reexport` (`implicit_reexport = false`), which means that objects imported into a module will not be re-exported for import into other modules. Imports can be made into explicit exports with the syntax `from module import x as x` (i.e., changing from `import logging` to `import logging as logging`), or by including imports in `__all__`. This explicit import syntax can be confusing. Another option is to apply mypy overrides to any modules that need to leverage implicit exports.

### Spell check

Spell check is performed with [CSpell](https://cspell.org/). The CSpell command is included in the Hatch script for code quality checks (`hatch run check`). -->

## GitHub Actions workflows

[GitHub Actions](https://github.com/features/actions) is a continuous integration/continuous deployment (CI/CD) service that runs on GitHub repos. It replaces other services like Travis CI. Actions are grouped into workflows and stored in _.github/workflows_.

## Maintainers

- **The default branch is `develop`.**
- **PRs should be merged into `develop`.**
- **The only merges to `main` should be fast-forward merges from `develop`.**
- **Branch protection is enabled on `develop` and `main`.**
  - `develop`:
    - Require signed commits
    - Include administrators
    - Allow force pushes
  - `main`:
    - Require signed commits
    - Include administrators
    - Do not allow force pushes
    - Require status checks to pass before merging (commits must have previously been pushed to `develop` and passed all checks)
- **To commit:**
  - Follow the [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/#specification) specification for commit messages. This standardizes the commit history and facilitates automatic generation of the changelog.
  - _Type_ must be one of the following:
    - `build`: Changes that affect the build system or external dependencies (example scopes: gulp, broccoli, npm)
    - `ci`: Changes to our CI configuration files and scripts (example scopes: Travis, Circle, BrowserStack, SauceLabs)
    - `docs`: Documentation only changes
    - `feat`: A new feature
    - `fix`: A bug fix
    - `perf`: A code change that improves performance
    - `refactor`: A code change that neither fixes a bug nor adds a feature
    - `style`: Changes that do not affect the meaning of the code (white-space, formatting, missing semi-colons, etc)
    - `test`: Adding missing tests or correcting existing tests
  - Ensure your commit messages clearly describe the changes made and follow the format `type(scope?): subject`, where `scope` is optional.

- **To create a release:**
  - Follow [SemVer](https://semver.org/) guidelines when choosing a version number. Note that [PEP 440](https://peps.python.org/pep-0440/) Python version specifiers and SemVer version specifiers differ, particularly with regard to specifying prereleases. Use syntax compatible with both.
  - The PEP 440 default (like `1.0.0a0`) is different from SemVer.
  - An alternative form of the Python prerelease syntax permitted in PEP 440 (like `1.0.0-alpha.0`) is compatible with SemVer, and this form should be used when tagging releases.
  - Examples of acceptable tag names: `1.0.0`, `1.0.0-alpha.0`, `1.0.0-beta.1`
  - Push to `develop` and verify all CI checks pass.
  - Fast-forward merge to `main`, push, and verify all CI checks pass.
